#!/usr/bin/env node

var docopt = require('docopt').docopt,
    utils = require('../lib/utils.js');

var INFRASTRUCTURE_FILENAME = 'main.json';

var doc = '\
Usage:\n\
    hflowc apply\n\
    hflowc destroy\n\
';

var opts = docopt(doc);

//read infrastructure description
utils.readFile(INFRASTRUCTURE_FILENAME, function (err, data) {
    if (err) {
        console.log('Unable to read main.json!');
        return;
    }

    var infra = JSON.parse(data);
    var provierName = infra.provider.name;

    try {
        var provider = require('../lib/' + provierName + '_provider.js').createProvider(infra);
    } catch (e) {
        console.log("Unable to initialize " + provierName + " provider!");
        return
    }

    if (opts.apply) {
        provider.createInfrastructure();
    } else if (opts.destroy) {
        provider.destroyInfrastructure();
    } else {
        console.log("Command is missing");
    }

});